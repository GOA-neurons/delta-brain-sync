name: Sync to Hugging Face
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true

      - name: Push Code to HF
        run: |
          git config --global user.email "commander@goa.com"
          git config --global user.name "TELEFOXX"
          # üî± Header Injection Method: URL ·Äë·Ä≤·Äô·Äæ·Ä¨ Token ·Äô·Äï·Ä´·Äú·Ä≠·ÄØ·Ä∑ Special Character Error ·Äô·Äê·ÄÄ·Ä∫·Äê·Ä±·Ä¨·Ä∑·Äò·Ä∞·Ä∏
          git config --global http."https://huggingface.co/".extraheader "AUTHORIZATION: Bearer ${{ secrets.HF_TOKEN }}"
          git remote set-url origin https://huggingface.co/spaces/TELEFOXX/GOA
          git push --force origin main

      - name: Sync Secrets to HF
        run: |
          curl -X POST https://huggingface.co/api/spaces/TELEFOXX/GOA/variables \
            -H "Authorization: Bearer ${{ secrets.HF_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "variables": [
                {"key": "DATABASE_URL", "value": "${{ secrets.DATABASE_URL }}"},
                {"key": "SUPABASE_URL", "value": "${{ secrets.SUPABASE_URL }}"},
                {"key": "SUPABASE_KEY", "value": "${{ secrets.SUPABASE_KEY }}"},
                {"key": "GROQ_API_KEY", "value": "${{ secrets.GROQ_API_KEY }}"},
                {"key": "FIREBASE_CONFIG", "value": "${{ secrets.FIREBASE_CONFIG }}"}
              ]
            }'
            
