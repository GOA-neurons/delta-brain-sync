name: GOA Neural Evolution & Trinity Sync
on:
  schedule:
    - cron: '*/10 * * * *'  # ğŸ”± áá€ á€™á€­á€”á€…á€ºá€á€…á€ºá€á€« Neural Evolution á€œá€¯á€•á€ºá€™á€Šá€º
  workflow_dispatch:        # ğŸ”± Manual Run á€œá€­á€¯á€·á€›á€¡á€±á€¬á€„á€º

jobs:
  evolve_and_sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Python Dependencies
        run: |
          pip install --upgrade pip
          # ğŸ”± UI á€™á€•á€«á€˜á€² run á€™á€¾á€¬á€™á€­á€¯á€·á€œá€­á€¯á€· á€œá€­á€¯á€¡á€•á€ºá€á€²á€· dependencies á€á€½á€±á€€á€­á€¯á€•á€² á€¡á€“á€­á€€á€á€„á€ºá€™á€šá€º
          pip install psycopg2-binary requests groq sentence-transformers gradio python-dotenv

      - name: Install Node.js Dependencies
        run: npm install 

      - name: Step 1 - Run Evolution Engine
        env:
          DATABASE_URL: ${{ secrets.NEON_KEY }}
          NEON_KEY: ${{ secrets.NEON_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          FIREBASE_KEY: ${{ secrets.FIREBASE_KEY }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          HEADLESS_MODE: "true" # ğŸ”± UI á€€á€­á€¯ á€€á€»á€±á€¬á€ºá€›á€”á€º Flag á€•á€±á€¸á€œá€­á€¯á€€á€ºá€á€¼á€„á€ºá€¸
        run: python app.py

      - name: Step 2 - Run Trinity Sync Engine
        env:
          NEON_KEY: ${{ secrets.NEON_KEY }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          FIREBASE_KEY: ${{ secrets.FIREBASE_KEY }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: node delta_sync.js
